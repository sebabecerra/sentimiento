---
title: "Sentimiento en el Informe de Estabilidad Financiera∗"
author:
  - Sebastian Becerra^[Central Bank of Chile, seba.becerra@gmail.com]
  - Alejandra Cruces^[Central Bank of Chile, acruces@gmail.com]

date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document: default
---


```{r message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

#instalamos los paquetes si hace falta
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("fs")) install.packages("fs")
if(!require("readxl")) install.packages("readxl")


#paquetes
library(plotly)
library(tidyverse)
library(fs)
library(readxl)
library(reshape2)
library(ggplot2)
```


<font size="3" color="black"><p style="text-align:justify;">
The Financial Stability Report of Chile is the tool that provides the diagnosis on the financial markets of the Central Bank of Chile and it is also the instrument of policy and macro-prundary measures. This is why it is important to know the messages it contains and how they relate to the country's financial context. Two important products are generated from this work, a dictionary of financial stability in Spanish and a Financial Sentiment Index. The dictionary is robust and in line with other similar dictionaries. On the other hand, the Financial Sentiment Index is correlated with different macro-financial events that affect the country, and also with financial indicators that account for both local and global financial and economic conditions.
</p></font>

```{r echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.align = 'center', out.width = '100%'}
path="D:/Trabajo/TextMining/web/"
g1_1<-read_excel(paste0(path,"FSI.xlsx"),"FSI eventos")
g1_1$ventanal=-1
g1_1$ventanah=1
fig1_1 <- plot_ly(g1_1, y = ~pos, x = ~Fecha, type = 'bar', name = 'FSI',marker = list(color = 'blue'), hoverinfo = 'text', text = ~paste('</br> Fecha: ',Fecha,
                      '</br> Valor: ', format(pos, digits = 1)),showlegend=F) %>% add_trace(y = ~neg, name = 'FSI', marker = list(color = 'red'), hoverinfo = 'text', text = ~paste('</br> Fecha: ',Fecha,
                      '</br> Valor: ', format(neg, digits = 1)),showlegend=F) %>%  add_trace(y=~ventanal, x=~Fecha, type="scatter", mode="lines",line=list(color='rgba(7, 164, 181, 0.0)', size=0),fill="tozeroy", fillcolor = 'rgba(7, 164, 181, 0.1)', marker = list(color = 'rgba(7, 164, 181, 0)', size=0.000, opacity=1),showlegend=F)  %>%  add_trace(y=~ventanah, x=~Fecha, type="scatter", mode="lines",line=list(color='rgba(7, 164, 181, 0.0)', size=0), marker = list(color = "'rgba(7, 164, 181, 0)'", size=0.000, opacity=1),fill="tozeroy", fillcolor = 'rgba(7, 164, 181, 0.1)',showlegend=F)  %>% layout(legend = list(orientation = "h", xanchor = "center", x = 0.5))  %>%  layout(title = list(text = paste0('', '<br>', '<sup>','', '</sup>')),
         xaxis = list(title = "", showgrid = F,  tick0="1", dtick="1", ticktext = list("","04-S1","04-S2","05-S1", "05-S2" ,"06-S1","06-S2","07-S1", "07-S2","08-S1","08-S2","09-S1", "09-S2" ,"10-S1","10-S2","11-S1", "11-S2", "12-S1","12-S2","13-S1", "13-S2" ,"14-S1","14-S2","15-S1", "15-S2","16-S1","16-S2","17-S1", "17-S2" ,"18-S1","18-S2","19-S1", "19-S2", "20-S1","" ),tickvals = list(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22,23,24,25,26,27,28,29,30,31,32,33,34), range=c(0.5,33.6)),
          yaxis = list(title = "", side="left",range=c(-3,3),dtick=1,showgrid = F, linecolor="black"), barmode="relative",  shapes=list(list(type='line', x0= "7.5", x1= "7.5", y0=-3, y1=3, line  =list (dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "9.5", x1= "9.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "12.5", x1= "12.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "21.5", x1= "21.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "24.5", x1= "24.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "28.5", x1= "28.5", y0=-1, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "30.5", x1= "30.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "31.5", x1= "31.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3),list(type='line', x0= "32.5", x1= "32.5", y0=-3, y1=3, line=list(dash='dot', width=4, color="gray"), opacity = 0.3)),annotations = list(list(text = "Crisis <br> Subprime",  x = "7", y = 2,showarrow=T, xanchor="rigth"),list( text="Quiebra<br>Lehman<br>Brothers", x="9.5", y=-1,ax=5,ay =40, showarrow=T, xanchor="rigth"),list(text = "Terremoto",  x = "12.5", y = 1.5,showarrow=T, xanchor="rigth"),list(text = "Reforma<br>Tributaria",  x = "21.5", y = 1.5,showarrow=T, xanchor="rigth"),list(text = "Normativa<br>Provisiones<br>LVT",  x = "24.5", y = 2,showarrow=T, xanchor="rigth"),list(text = "Guerra<br>Comercial",  x = "28.5", y = 2,showarrow=T, xanchor="rigth"),list(text = "Aprobación<br>LGB",  x = "30.5", y = -1,ax=-10,ay =30,showarrow=T, xanchor="rigth"),list(text = "Estallido<br>Social",  x = "31.5", y = 2,showarrow=T, xanchor="rigth"),list(text = "Crisis<br>Sanitaria",  x = "32.5", y = -1.3, ax=5,ay =30,showarrow=T, xanchor="rigth"))) %>% config(modeBarButtonsToRemove = c("zoom2d", "pan2d", "select2d", "lasso2d", "zoomIn2d", "zoomOut2d", "autoScale2d", "resetScale2d", "hoverClosestCartesian", "hoverCompareCartesian", "zoom3d", "pan3d", "resetCameraDefault3d", "resetCameraLastSave3d", "hoverClosest3d", "orbitRotation", "tableRotation", "zoomInGeo", "zoomOutGeo", "resetGeo", "hoverClosestGeo", "sendDataToCloud", "hoverClosestGl2d", "hoverClosestPie", "toggleHover", "resetViews", "toggleSpikelines", "resetViewMapbox"),displaylogo = FALSE)
fig1_1

```

